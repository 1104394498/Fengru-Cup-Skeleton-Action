# 2s-AGCN

Two-Stream Adaptive Graph Convolutional Networks for Skeleton-Based Action Recognition in CVPR19

xview+xsub   joint+bone

# Note

Now we have updated the code to >=Pytorch0.4. \
A new model named AAGCN is added, which can achieve better performance. 

# Data Preparation

 - Download the raw data from [NTU-RGB+D](https://github.com/shahroudy/NTURGB-D) and [Skeleton-Kinetics](https://github.com/yysijie/st-gcn). Then put them under the data directory:

      -data\  
        -kinetics_raw\  
          -kinetics_train\
            ...
          -kinetics_val\
            ...
          -kinetics_train_label.json
          -keintics_val_label.json
        -nturgbd_raw\  
          -nturgb+d_skeletons\
            ...
          -samples_with_missing_skeletons.txt

   **skeletons数据放置：\data\nturgbd_raw\nturgb+d_skeletons\\**

   

 - Preprocess the data with

   `python data_gen/ntu_gendata.py`

 - Generate the bone data with: 

   `python data_gen/gen_bone_data.py`

# Training & Testing

Change the config file depending on what you want. 	在config里修改参数


```python
# parameter priority: command line > config > default

python run.py --config ./config/nturgbd-cross-view/train_joint.yaml`

python run.py --config ./config/nturgbd-cross-view/train_bone.yaml

# --config 里设置参数，也可直接命令行：--device 0 --num-epoch 50 --batch-size 16
#（具体设置见 run.py get_parser）

```

To ensemble the results of joints and bones, run test firstly to generate the scores of the softmax layer. 

```python
python run.py --config ./config/nturgbd-cross-view/test_joint.yaml
python run.py --config ./config/nturgbd-cross-view/test_bone.yaml

python run.py --config ./config/nturgbd-cross-subject/test_joint.yaml
python run.py --config ./config/nturgbd-cross-subject/test_bone.yaml

# --config 里设置参数：注意选择./runs里保存的训练结果 --weights ./runs/ntu_cv_agcn_bone-3-4.pt

```

**如果要输出csv文件，选用predict.py**

```python
python predict.py --config ./config/nturgbd-cross-view/test_joint.yaml  
# 参数基本同上
# --save-score true 则保存结果用于 ensemble.py
```



Then combine the generated scores with: 

```python
python ensemble.py --datasets ntu/xview

python ensemble.py --datasets ntu/xsub

# --alpha 1
# 用于调整权重 weighted summation
```



